<?xml version="1.0" encoding="utf-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="styles.css"/>
    <title>使用ssh-keygen和ssh-copy-id三步实现SSH无密码登录 和ssh常用命令</title>
  </head>
  <body><h1 id="chapterTitle">使用ssh-keygen和ssh-copy-id三步实现SSH无密码登录 和ssh常用命令</h1><hr/>
<div id="article_content" class="article_content csdn-tracking-statistics tracking-click">
<p><strong>ssh-keygen</strong>  产生公钥与私钥对.</p>
<p><strong>ssh-copy-id</strong> 将本机的公钥复制到远程机器的authorized_keys文件中，ssh-copy-id也能让你有到远程机器的home, ~./ssh , 和 ~/.ssh/authorized_keys的权利</p>
<br/>
第一步:在本地机器上使用ssh-keygen产生公钥私钥对
<div id="codeText" class="codeText">
<ol class="dp-css c1"><li>zhz@zhz:~/$ ssh-keygen<br/>
Generating public/private rsa key pair.<br/>
Enter file in which to save the key (/home/zhz/.ssh/id_rsa):</li>
<li>Enter passphrase (empty for no passphrase): [Press enter key</li>
<li>same passphrase again: [Pess enter key]</li>
<li>Your identification has been saved in /home/zhz/.ssh/id_rsa.</li>
<li>Your public key has been saved in /home/zhz/.ssh/id_rsa.pub.</li>
<li>The key fingerprint is:</li>
<li>用cat命令查看是否生成产生公钥私钥对</li>
<li>zhz@zhz:~$ cat .ssh/id_rsa.pub<br/>
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCl9N5+xboqSIagBx02rdZ2fkROCPW8iW7hl6Gu+2hkBYYy/b1qcOm8RF/AMyas3i0QEK7Hcu9H51l2lulVbS5n9M9FaWIyYzssaS012x2mg9iA6MxPMlaXFsZ5jnVrGicndzf3VUu9kCErp5q0OzzMjsG3PKQevzWZJSBaFgc8NF5ZJ+VT54BN8ktMTHVwOo15I2Uai+bs4eP0NsuwIJmGyYIUOuvTuUtJxGV3hZ+tcjhupupqVCwYOE+cDz8VkFBGtnKsdE69hWoY2VUfEOAfHZptra7Ce9dXfDgx9jxuuNiJYtGo/bZDfe+UJ5HUv8wrL+hFeRIihdmP2CKJD8j5 zhz@zhz</li>
</ol></div>
第二步:用ssh-copy-id将公钥复制到远程机器中
<div class="codeText">
<ol class="dp-css c1"><li>zhz@zhz:~$  ssh-copy-id -i .ssh/id_rsa.pub  用户名字@192.168.x.xxx</li>
</ol></div>
<p><strong>注意:</strong> ssh-copy-id <strong>将key写到远程机器的 ~/</strong> .ssh/authorized_key.文件中</p>
第三步:<a href="mailto:jsmith@local-host$">登录到</a>远程机器不用输入密码
<div class="codeText">
<ol class="dp-css c1"><li>zhz@zhz:~$  ssh 用户名字@192.168.x.xxx</li>
<li><br/></li>
<li>Last login: Sun Nov 16 17:22:33 2008 from 192.168.1.2</li>
</ol></div>
<p>常见问题：</p>
<div class="codeText">
<ol class="dp-css c1"><li>ssh-copy-id -u eucalyptus -i ~eucalyptus/.ssh/id_rsa.pub <a href="mailto:eucalyptus@remote_host">ssh 用户名字@192.168.x.xxx</a></li>
<li>第一次需要密码登录<br/></li>
</ol></div>
<p>上述是给eucalyptus用户赋予无密码登陆的权利</p>
<div class="codeText">
<ol class="dp-css c1"><li>/usr/bin/ssh-copy-id: ERROR: No identities found</li>
</ol></div>
<p>使用选项 <em>-i</em> ，当没有值传递的时候或者 如果 <em>~/.ssh/identity.pub</em> 文件不可访问（不存在）, <em>ssh-copy-id</em> 将显示上述的错误信息  （ -i选项会优先使用将ssh-add -L的内容）</p>
<p>ssh命令</p>
<p><strong>1、复制SSH密钥到目标主机，开启无密码SSH登录</strong></p>
<pre>ssh-copy-id user@host
</pre>
<p>如果还没有密钥，请使用ssh-keygen命令生成。</p>
<p><strong>2、从某主机的80端口开启到本地主机2001端口的隧道</strong></p>
<pre>ssh -N -L2001:localhost:80 somemachine
</pre>
<p>现在你可以直接在浏览器中输入http://localhost:2001访问这个网站。</p>
<p><strong>3、将你的麦克风输出到远程计算机的扬声器</strong></p>
<pre>dd if=/dev/dsp | ssh -c arcfour -C username@host dd of=/dev/dsp
</pre>
<p>这样来自你麦克风端口的声音将在SSH目标计算机的扬声器端口输出，但遗憾的是，声音质量很差，你会听到很多嘶嘶声。</p>
<p><strong>4、比较远程和本地文件</strong></p>
<pre>ssh user@host cat /path/to/remotefile | diff /path/to/localfile –
</pre>
<p>在比较本地文件和远程文件是否有差异时这个命令很管用。</p>
<p><strong>5、通过SSH挂载目录/文件系统</strong></p>
<pre>sshfs name@server:/path/to/folder /path/to/mount/point
</pre>
<p>从<a href="http://fuse.sourceforge.net/sshfs.html">http://fuse.sourceforge.net/sshfs.html</a>下载sshfs，它允许你跨网络安全挂载一个目录。</p>
<p><strong>6、通过中间主机建立SSH连接</strong></p>
<pre>ssh -t reachable_host ssh unreachable_host
</pre>
<p>Unreachable_host表示从本地网络无法直接访问的主机，但可以从reachable_host所在网络访问，这个命令通过到reachable_host的“隐藏”连接，创建起到unreachable_host的连接。</p>
<p><strong>7、将你的SSH公钥复制到远程主机，开启无密码登录 – 简单的方法</strong></p>
<pre>ssh-copy-id username@hostname
</pre>
<p><strong>8、直接连接到只能通过主机B连接的主机A</strong></p>
<pre>ssh -t hostA ssh hostB
</pre>
<p>当然，你要能访问主机A才行。</p>
<p><strong>9、创建到目标主机的持久化连接</strong></p>
<pre>ssh -MNf &lt;user&gt;@&lt;host&gt;
</pre>
<p>在后台创建到目标主机的持久化连接，将这个命令和你~/.ssh/config中的配置结合使用：</p>
<pre>Host host
ControlPath ~/.ssh/master-%r@%h:%p
ControlMaster no
</pre>
<p>所有到目标主机的SSH连接都将使用持久化SSH套接字，如果你使用SSH定期同步文件（使用rsync/sftp/cvs/svn），这个命令将非常有用，因为每次打开一个SSH连接时不会创建新的套接字。</p>
<p><strong>10、通过SSH连接屏幕</strong></p>
<pre>ssh -t remote_host screen –r
</pre>
<p>直接连接到远程屏幕会话（节省了无用的父bash进程）。</p>
<p><strong>11、端口检测（敲门）</strong></p>
<pre>knock &lt;host&gt; 3000 4000 5000 &amp;&amp; ssh -p &lt;port&gt; user@host &amp;&amp; knock &lt;host&gt; 5000 4000 3000
</pre>
<p>在一个端口上敲一下打开某个服务的端口（如SSH），再敲一下关闭该端口，需要先安装knockd，下面是一个配置文件示例。</p>
<pre>[options]
logfile = /var/log/knockd.log
[openSSH]
sequence = 3000,4000,5000
seq_timeout = 5
command = /sbin/iptables -A INPUT -i eth0 -s %IP% -p tcp –dport 22 -j ACCEPT
tcpflags = syn
[closeSSH]
sequence = 5000,4000,3000
seq_timeout = 5
command = /sbin/iptables -D INPUT -i eth0 -s %IP% -p tcp –dport 22 -j ACCEPT
tcpflags = syn
</pre>
<p><strong>12、删除文本文件中的一行内容，有用的修复</strong></p>
<pre>ssh-keygen -R &lt;the_offending_host&gt;
</pre>
<p>在这种情况下，最好使用专业的工具。</p>
<p><strong>13、通过SSH运行复杂的远程shell命令</strong></p>
<pre>ssh host -l user $(&lt;cmd.txt)
</pre>
<p>更具移植性的版本：</p>
<pre>ssh host -l user “`cat cmd.txt`”
</pre>
<p><strong>14、通过SSH将MySQL数据库复制到新服务器</strong></p>
<pre>mysqldump –add-drop-table –extended-insert –force –log-error=error.log -uUSER -pPASS OLD_DB_NAME | ssh -C user@newhost “mysql -uUSER -pPASS NEW_DB_NAME”
</pre>
<p>通过压缩的SSH隧道Dump一个MySQL数据库，将其作为输入传递给mysql命令，我认为这是迁移数据库到新服务器最快最好的方法。</p>
<p><strong>15、删除文本文件中的一行，修复“SSH主机密钥更改”的警告</strong></p>
<pre>sed -i 8d ~/.ssh/known_hosts
</pre>
<p><strong>16、从一台没有SSH-COPY-ID命令的主机将你的SSH公钥复制到服务器</strong></p>
<pre>cat ~/.ssh/id_rsa.pub | ssh user@machine “mkdir ~/.ssh; cat &gt;&gt; ~/.ssh/authorized_keys”
</pre>
<p>如果你使用Mac OS X或其它没有ssh-copy-id命令的*nix变种，这个命令可以将你的公钥复制到远程主机，因此你照样可以实现无密码SSH登录。</p>
<p><strong>17、实时SSH网络吞吐量测试</strong></p>
<pre>yes | pv | ssh $host “cat &gt; /dev/null”
</pre>
<p>通过SSH连接到主机，显示实时的传输速度，将所有传输数据指向/dev/null，需要先安装pv。</p>
<p>如果是Debian：</p>
<pre>apt-get install pv
</pre>
<p>如果是Fedora：</p>
<pre>yum install pv
</pre>
<p>（可能需要启用额外的软件仓库）。</p>
<p><strong>18、如果建立一个可以重新连接的远程GNU screen</strong></p>
<pre>ssh -t user@some.domain.com /usr/bin/screen –xRR
</pre>
<p>人们总是喜欢在一个文本终端中打开许多shell，如果会话突然中断，或你按下了“Ctrl-a d”，远程主机上的shell不会受到丝毫影响，你可以重新连接，其它有用的screen命令有“Ctrl-a c”（打开新的shell）和“Ctrl-a a”（在shell之间来回切换），请访问http://aperiodic.net/screen/quick_reference阅读更多关于screen命令的快速参考。</p>
<p><strong>19、继续SCP大文件</strong></p>
<pre>rsync –partial –progress –rsh=ssh $file_source $user@$host:$destination_file
</pre>
<p>它可以恢复失败的rsync命令，当你通过VPN传输大文件，如备份的数据库时这个命令非常有用，需要在两边的主机上安装rsync。</p>
<pre>rsync –partial –progress –rsh=ssh $file_source $user@$host:$destination_file local -&gt; remote
</pre>
<p>或</p>
<pre>rsync –partial –progress –rsh=ssh $user@$host:$remote_file $destination_file remote -&gt; local
</pre>
<p><strong>20、通过SSH W/ WIRESHARK分析流量</strong></p>
<pre>ssh root@server.com ‘tshark -f “port !22″ -w -' | wireshark -k -i –
</pre>
<p>使用tshark捕捉远程主机上的网络通信，通过SSH连接发送原始pcap数据，并在wireshark中显示，按下Ctrl+C将停止捕捉，但也会关闭wireshark窗口，可以传递一个“-c #”参数给tshark，让它只捕捉“#”指定的数据包类型，或通过命名管道重定向数据，而不是直接通过SSH传输给wireshark，我建议你过滤数据包，以节约带宽，tshark可以使用tcpdump替代：</p>
<pre>ssh root@example.com tcpdump -w – ‘port !22′ | wireshark -k -i –
</pre>
<p><strong>21、保持SSH会话永久打开</strong></p>
<pre>autossh -M50000 -t server.example.com ‘screen -raAd mysession’
</pre>
<p>打开一个SSH会话后，让其保持永久打开，对于使用笔记本电脑的用户，如果需要在Wi-Fi热点之间切换，可以保证切换后不会丢失连接。</p>
<p><strong>22、更稳定，更快，更强的SSH客户端</strong></p>
<pre>ssh -4 -C -c blowfish-cbc
</pre>
<p>强制使用IPv4，压缩数据流，使用Blowfish加密。</p>
<p><strong>23、使用cstream控制带宽</strong></p>
<pre>tar -cj /backup | cstream -t 777k | ssh host ‘tar -xj -C /backup’
</pre>
<p>使用bzip压缩文件夹，然后以777k bit/s速率向远程主机传输。Cstream还有更多的功能，请访问http://www.cons.org/cracauer/cstream.html#usage了解详情，例如：</p>
<pre>echo w00t, i’m 733+ | cstream -b1 -t2
</pre>
<p><strong>24、一步将SSH公钥传输到另一台机器</strong></p>
<pre>ssh-keygen; ssh-copy-id user@host; ssh user@host
</pre>
<p>这个命令组合允许你无密码SSH登录，注意，如果在本地机器的~/.ssh目录下已经有一个SSH密钥对，ssh-keygen命令生成的新密钥可能会覆盖它们，ssh-copy-id将密钥复制到远程主机，并追加到远程账号的~/.ssh/authorized_keys文件中，使用SSH连接时，如果你没有使用密钥口令，调用ssh user@host后不久就会显示远程shell。</p>
<p><strong>25、将标准输入（stdin）复制到你的X11缓冲区</strong></p>
<pre>ssh user@host cat /path/to/some/file | xclip
</pre>
<p>你是否使用scp将文件复制到工作用电脑上，以便复制其内容到电子邮件中？xclip可以帮到你，它可以将标准输入复制到X11缓冲区，你需要做的就是点击鼠标中键粘贴缓冲区中的内容。</p>
<p>原文：<a href="http://blog.urfix.com/25-ssh-commands-tricks/">http://blog.urfix.com/25-ssh-commands-tricks/</a></p>

</div>
</html>
